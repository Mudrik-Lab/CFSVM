

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>CFS tutorial &#8212; CFSVM v0.4.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/solid.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/brands.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'cfs_tutorial';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Fixation generator" href="fixation_generator.html" />
    <link rel="prev" title="Installation" href="installation.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo_round.bmp" class="logo__image only-light" alt="Continuous flash suppression & Visual masking"/>
    <script>document.write(`<img src="_static/logo_round.bmp" class="logo__image only-dark" alt="Continuous flash suppression & Visual masking"/>`);</script>
  
  
    <p class="title logo__title">CFSVM</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        CFS tutorial
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="fixation_generator.html">
                        Fixation generator
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="mondrian_generator.html">
                        Mondrian generator
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="%2BCFSVM.html">
                        API reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Mudrik-Lab/CFS" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://people.socsci.tau.ac.il/mu/mudriklab/" title="MudrikLab" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="_static/mudriklab_logo.png" class="icon-link-image" alt="MudrikLab"/></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="installation.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        CFS tutorial
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="fixation_generator.html">
                        Fixation generator
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="mondrian_generator.html">
                        Mondrian generator
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="%2BCFSVM.html">
                        API reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/Mudrik-Lab/CFS" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
            
          
          
          
          
          
          
          
          
          
          <a href="https://people.socsci.tau.ac.il/mu/mudriklab/" title="MudrikLab" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><img src="_static/mudriklab_logo.png" class="icon-link-image" alt="MudrikLab"/></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">CFS tutorial</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="cfs-tutorial">
<h1>CFS tutorial<a class="headerlink" href="#cfs-tutorial" title="Permalink to this heading">#</a></h1>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Author</span><span class="p">:</span> <span class="n">Gennadiy</span> <span class="n">Belonosov</span> <span class="o">&lt;</span><span class="n">gennadiyb</span><span class="nd">@mail</span><span class="o">.</span><span class="n">tau</span><span class="o">.</span><span class="n">ac</span><span class="o">.</span><span class="n">il</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>üí° Here we explain how to use the CFSVM package to create a CFS experiment. As a reference, we roughly implemented Experiment 2 from the original Tsuchiya and Koch <a class="reference external" href="https://doi.org/10.1038/nn1500">study</a>.</p>
<section id="start-from-installing-the-package">
<h2>Start from installing the package<a class="headerlink" href="#start-from-installing-the-package" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="installation.html"><span class="doc std std-doc">How to install</span></a></p></li>
</ul>
</section>
<section id="a-word-of-caution">
<h2>A word of caution<a class="headerlink" href="#a-word-of-caution" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>This tutorial is only intended to present the potential use and some functions of the package.</p></li>
<li><p>An exact replication of the original Tsuchiya &amp; Koch experiments is possible, but requires deeper modifications of the code, which are not discussed here.</p></li>
<li><p>For simplicity, Gabor patch parameters such as spatial frequency, luminance etc. are ignored.</p></li>
<li><p>The Gabor patches were generated <a class="reference external" href="https://www.cogsci.nl/gabor-generator">here</a>.</p></li>
</ul>
</section>
<section id="extracting-parameters-from-tsuchiya-kochs-experiment-2">
<h2>Extracting parameters from Tsuchiya &amp; Koch‚Äôs experiment #2<a class="headerlink" href="#extracting-parameters-from-tsuchiya-kochs-experiment-2" title="Permalink to this heading">#</a></h2>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p><img alt="Methods figure from Tsuchiya &amp; Koch, 2005" src="_images/tnk.png" /></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><em>Methods figure from Tsuchiya &amp; Koch, 2005</em></p></td>
</tr>
</tbody>
</table>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p><img alt="Figure created using the package" src="_images/cfs_description.png" /></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><em>Implementation using the package: an example of the stimuli and the display. The left eye is presented with two gratings at different orientations. The right eye is presented with the CFS Mondrian display and a blank screen.</em></p></td>
</tr>
</tbody>
</table>
<p>We extracted the following parameters from the <a class="reference external" href="https://www.nature.com/articles/nn1500#Sec9">Methods section</a> and <a class="reference external" href="https://www.nature.com/articles/nn1500#Sec15">Supplementary Table 1</a> of the paper:</p>
<ul class="simple">
<li><p>The contrast of two Gabor patches was set to 30%.</p></li>
<li><p>The phase and orientation of the Gabors were chosen randomly.</p></li>
<li><p>The flashing frequency of the Mondrians was 10 Hz.</p></li>
<li><p>Adaptation continued for 5 seconds.</p></li>
<li><p>After the adaptation a gray background was shown.</p></li>
<li><p>In 20 experimental trials two Gabor patches were simultaneously shown on both the left and right sides of the display presented to the left eye (see figure above).</p></li>
<li><p>In 10 catch trials, a Gabor patch was presented only on the non-suppressed side of the display (e.g., if the Mondrians are presented on the right side, as in the figure above, only the left side Gabor will be presented).</p></li>
<li><p>The 10 catch trials were randomly interleaved with the 20 experimental trials.</p></li>
</ul>
</section>
<section id="preparing-the-experiment">
<h2>Preparing the experiment<a class="headerlink" href="#preparing-the-experiment" title="Permalink to this heading">#</a></h2>
<p>üí° The following section explains how to use the package to program your experiment.</p>
<section id="create-the-experiment-folder">
<h3>Create the experiment folder<a class="headerlink" href="#create-the-experiment-folder" title="Permalink to this heading">#</a></h3>
<p>We will organize the experiment according to the <a class="reference external" href="https://osf.io/5kfrc/wiki/Chapter%203:%20Data%20Organization/">HLC lab handbook</a>.
The initial folder structure will look like this (only relevant for this tutorial folders are shown):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>TnK_experiment_2/
‚îú‚îÄ‚îÄ Experiment/
‚îÇ   ‚îî‚îÄ‚îÄ RUN_ME/
|       ‚îú‚îÄ‚îÄ Code/
|       ‚îî‚îÄ‚îÄ Stimuli/
‚îî‚îÄ‚îÄ Raw Data/
    ‚îî‚îÄ‚îÄ Behavioral/
</pre></div>
</div>
</section>
<section id="stimuli">
<h3>Stimuli<a class="headerlink" href="#stimuli" title="Permalink to this heading">#</a></h3>
<p>Create a new folder called <code class="docutils literal notranslate"><span class="pre">Suppressed/</span></code> inside the <code class="docutils literal notranslate"><span class="pre">Stimuli/</span></code> and put in it two Gabor images with transparent backgrounds and opposite phases, like these:</p>
<p><img alt="Gabor1" src="_images/gabor1.png" /> <img alt="Gabor2" src="_images/gabor2.png" /></p>
<p>Your <code class="docutils literal notranslate"><span class="pre">RUN_ME</span></code> folder structure should now look somewhat like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RUN_ME/
‚îú‚îÄ‚îÄ Code/
‚îî‚îÄ‚îÄ Stimuli/
    ‚îî‚îÄ‚îÄ Suppressed/
        ‚îú‚îÄ‚îÄ gabor_1.png
        ‚îî‚îÄ‚îÄ gabor_2.png
</pre></div>
</div>
</section>
<section id="trial-matrix">
<h3>Trial matrix<a class="headerlink" href="#trial-matrix" title="Permalink to this heading">#</a></h3>
<p>We will start by generating a list of trials specifying the experimental conditions.</p>
<ol class="arabic simple">
<li><p>Navigate to the <code class="docutils literal notranslate"><span class="pre">Code/</span></code> folder in the MATLAB files panel (or using the <code class="docutils literal notranslate"><span class="pre">cd</span></code> command).</p></li>
<li><p>To generate trials:</p>
<ul class="simple">
<li><p>You can either use the example script <em>TnK_generate_trials</em> (simply run it in the MATLAB command window, it will generate the trial matrix for this specific experiment) and navigate to <a class="reference internal" href="#the-last-step-or-two-before-the-run">the last step (or two) before the run</a> section in this tutorial.</p></li>
<li><p>Or you can create your own <em>generate_trials.m</em> file based on your needs. If you follow this way, your <code class="docutils literal notranslate"><span class="pre">RUN_ME</span></code> folder structure will now look like this:</p></li>
</ul>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RUN_ME/
‚îú‚îÄ‚îÄ Code/
|   ‚îî‚îÄ‚îÄ generate_trials.m
‚îî‚îÄ‚îÄ Stimuli/
    ‚îî‚îÄ‚îÄ Suppressed/
        ‚îú‚îÄ‚îÄ gabor_1.png
        ‚îî‚îÄ‚îÄ gabor_2.png
</pre></div>
</div>
<p>üí° The main idea of this script is to create an experiment object for each trial and save it in one <code class="docutils literal notranslate"><span class="pre">.mat</span></code> file. Let‚Äôs go over the script command by command.</p>
<section id="import-the-package">
<h4>Import the package<a class="headerlink" href="#import-the-package" title="Permalink to this heading">#</a></h4>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">import</span><span class="w"> </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Experiment</span><span class="o">.*</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Element</span><span class="p">.</span><span class="n">Screen</span><span class="o">.*</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Element</span><span class="p">.</span><span class="n">Data</span><span class="o">.*</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Element</span><span class="p">.</span><span class="n">Evidence</span><span class="o">.*</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Element</span><span class="p">.</span><span class="n">Stimulus</span><span class="o">.*</span>
</pre></div>
</div>
</section>
<section id="choose-the-experiment-type">
<h4>Choose the experiment type<a class="headerlink" href="#choose-the-experiment-type" title="Permalink to this heading">#</a></h4>
<p>There are two types of CFS experiment in the package: BCFS (breaking CFS) and VPCFS (visual priming CFS).
The two types have many common properties, as they are both Continuous Flash Suppression, yet they are different from each other in the following ways:</p>
<ul class="simple">
<li><p>The <strong>BCFS</strong> code includes a breakthrough property, which records the participant‚Äôs response during the time, indicating that she detected the stimulus. The trial then stops when this response is recorded.</p></li>
<li><p>The <strong>VPCFS</strong> code includes the mafc and pas properties which define the objective ( multiple-alternative forced choice) and subjective (perceptual awareness scale) measures of consciousness, respectively.</p></li>
</ul>
<p>As in this experiment neither of mAFC or PAS is used, we will build the experiment with the <strong>BCFS</strong> template.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">BCFS</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="initialize-the-objects-properties">
<h4>Initialize the object‚Äôs properties<a class="headerlink" href="#initialize-the-objects-properties" title="Permalink to this heading">#</a></h4>
<p>The <strong>BCFS</strong> template has multiple required properties:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Class</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>screen</p></td>
<td><p>CustomScreen</p></td>
</tr>
<tr class="row-odd"><td><p>subject_info</p></td>
<td><p>SubjectData</p></td>
</tr>
<tr class="row-even"><td><p>trials</p></td>
<td><p>TrialsData</p></td>
</tr>
<tr class="row-odd"><td><p>fixation</p></td>
<td><p>Fixation</p></td>
</tr>
<tr class="row-even"><td><p>frame</p></td>
<td><p>CheckFrame</p></td>
</tr>
<tr class="row-odd"><td><p>masks</p></td>
<td><p>Mondrians</p></td>
</tr>
<tr class="row-even"><td><p>breakthrough</p></td>
<td><p>BreakResponse</p></td>
</tr>
</tbody>
</table>
<p>We will initialize only a few of them here: <strong>fixation</strong>, <strong>frame</strong>, <strong>masks</strong>, <strong>breakthrough</strong>. The remaining properties will be initialized at the start of the experiment. We will also add two dynamic properties for stimuli, representing two Gabor patches.</p>
<section id="checkframe">
<h5>Checkframe<a class="headerlink" href="#checkframe" title="Permalink to this heading">#</a></h5>
<p>As for the CheckFrame: although the frames don‚Äôt appear in the original experiment, we will use them here as it is a common practice in the HLC lab. We will set <strong>hex_colors</strong> to black and white (<code class="docutils literal notranslate"><span class="pre">#000000</span></code> and <code class="docutils literal notranslate"><span class="pre">#FFFFFF</span></code>), <strong>checker_length</strong> to 30 pixels and <strong>checker_width</strong> to 15 pixels (checker is the small rectangle; the frame consists of multiple checkers).</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">frame</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">CheckFrame</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">hex_colors</span><span class="p">={</span><span class="s">&#39;#000000&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;#FFFFFF&#39;</span><span class="p">},</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">checker_length</span><span class="p">=</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">checker_width</span><span class="p">=</span><span class="mi">15</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="masks-generation">
<h5>Masks generation<a class="headerlink" href="#masks-generation" title="Permalink to this heading">#</a></h5>
<p>Next, we move on to the Mondrians. If you have pre-generated Mondrians, put them into <code class="docutils literal notranslate"><span class="pre">RUN_ME/Stimuli/Masks/</span></code> folder and skip to the <a class="reference internal" href="#masks-initialization">masks initialization</a>. Otherwise, we will use the <a class="reference internal" href="mondrian_generator.html"><span class="std std-doc">MondrianGenerator</span></a>. Note that it provides only basic functionality. If you want to create spatially, temporally or orientationally filtered or phase scrambled masks, refer to the CFS crafter: <a class="reference external" href="https://doi.org/10.3758/s13428-022-01903-7">(Wang &amp; Han, 2022)</a>, <a class="reference external" href="https://github.com/guandongwang/cfs_crafter">GitHub</a>.</p>
<ol class="arabic simple">
<li><p>Import the MondrianGenerator class and construct the generator object, using the code below. The generator will randomly locate a specific numbers of figures (defined as <strong>n_figures</strong>, 1000 by default) that are shaped in a specific manner (defined as <strong>type</strong>, which can be, for example, a rectangle, a circle or a rhombus; for more shapes check the documentation) with the minimum radius equal to <strong>x(y)_pixels</strong>√ó<strong>min_fraction</strong> and the maximum radius equal to <strong>x(y)_pixels</strong>√ó<strong>max_fraction</strong> inside the <code class="docutils literal notranslate"><span class="pre">provided_path/Masks/</span></code> folder (here <code class="docutils literal notranslate"><span class="pre">Stimuli/Masks/</span></code>).</p></li>
</ol>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">import</span><span class="w"> </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Generators</span><span class="p">.</span><span class="n">MondrianGenerator</span>
<span class="n">generator</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">MondrianGenerator</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;../Stimuli/&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % Will generate Mondrians inside path/Masks/</span>
<span class="w">    </span><span class="nb">type</span><span class="p">=</span><span class="s">&#39;rectangle&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % Available shapes are ‚Äòrectangle‚Äô, ‚Äòsquare‚Äô, ‚Äòellipse‚Äô, ‚Äòcircle‚Äô, ‚Äòrhombus‚Äô and ‚Äò45_rotated_square‚Äô.</span>
<span class="w">    </span><span class="n">x_pixels</span><span class="p">=</span><span class="mi">512</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % Width of generated images in pixels</span>
<span class="w">    </span><span class="n">y_pixels</span><span class="p">=</span><span class="mi">512</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % Height of generated images in pixels</span>
<span class="w">    </span><span class="n">min_fraction</span><span class="p">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % Minimal possible radius of a figure.</span>
<span class="w">    </span><span class="n">max_fraction</span><span class="p">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % Maximal possible radius of a figure.</span>
<span class="w">    </span><span class="n">n_figures</span><span class="p">=</span><span class="mi">1000</span><span class="p">,</span>
<span class="w">    </span><span class="n">cmap</span><span class="p">=</span><span class="s">&#39;grayscale&#39;</span><span class="w"> </span><span class="c">% Can be either string or MATLAB-styled RGB array.</span>
<span class="w">    </span><span class="p">);</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>For the colormap use the <strong>cmap</strong> argument from the code above. It can be either a string for the supported colormaps (‚Äògrayscale‚Äô, ‚Äòrgb‚Äô, ‚Äòoriginal‚Äô etc., for other options refer to the documentation) or you can provide the argument with the  <a class="reference external" href="https://www.mathworks.com/help/matlab/ref/colormap.html">MATLAB-formatted</a> RGB array. For the grayscale with 5 tones it will look something like this:</p></li>
</ol>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">cmap</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">      </span><span class="mf">0.25</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="mf">0.25</span><span class="w"> </span><span class="p">;</span>
<span class="w">      </span><span class="mf">0.5</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<span class="w">      </span><span class="mf">0.75</span><span class="w"> </span><span class="mf">0.75</span><span class="w"> </span><span class="mf">0.75</span><span class="p">;</span>
<span class="w">      </span><span class="n">1</span><span class="w"> </span><span class="s">1</span><span class="w"> </span><span class="s">1]</span>
</pre></div>
</div>
<p>In addition, you can use the <strong>set_shades()</strong> method if you want to use grayscale with different numbers of tones. <strong>set_shades()</strong> will take the RGB array as a first argument and create a gradient from this color to white with a number of tones provided as a second argument. In the code below it creates a gradient from black to white with 8 tones, i.e., black, white and 6 tones in between.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">generator</span><span class="p">.</span><span class="n">set_shades</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="mi">8</span><span class="p">);</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>We will provide the generator object with the physical properties of the display, so it will be able to calculate the power spectral densities of the Mondrians (the output .png and .csv files will be saved inside the <code class="docutils literal notranslate"><span class="pre">provided_path/</span></code> folder). The arguments are: width in cm, width in pixels, height in cm, height in pixels, viewing distance in cm.</p></li>
</ol>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">generator</span><span class="p">.</span><span class="n">set_physical_properties</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="w"> </span><span class="mi">1920</span><span class="p">,</span><span class="w"> </span><span class="mf">33.5</span><span class="p">,</span><span class="w"> </span><span class="mi">1080</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we will run the generator using the <strong>generate()</strong> method, which takes <strong>n_mondrians</strong> as an argument. In general, <strong>n_mondrians</strong>=temporal_frequency√óduration will generate enough masks, so that they are not repeated in a single trial. Here we will generate 10Hz*5sec=50 Mondrians.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">generator</span><span class="p">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="masks-initialization">
<h5>Masks initialization<a class="headerlink" href="#masks-initialization" title="Permalink to this heading">#</a></h5>
<p>Now, with generated Mondrians, we will set the <strong>masks</strong> property.
The first parameter we will define is the relative path to the folder containing the Mondrian images. If you‚Äôd like to work with CFS-crafter generated masks, you can set a path to the <code class="docutils literal notranslate"><span class="pre">.mat</span></code> file using <strong>crafter_masks</strong> argument (<strong>crafter_masks</strong> will override the <strong>dirpath</strong> if both have been provided).
We will set <strong>temporal_frequency</strong> to 10 Hz, <strong>duration</strong> to 5 seconds, and <strong>position</strong> to ‚ÄúRight‚Äù (so that the masks suppress only the right Gabor patch).
To adjust the Mondrians‚Äô position, we will set <strong>size</strong> to 0.45 (1 will fill the whole right eye field, 0.5 will fill half of the right eye field depending on position), <strong>padding</strong> to 0.3 (0 will align to the frame, 1 will align to the center of the fixation cross), and xy_ratio to 1 (square). You can also change the <strong>contrast</strong> and <strong>rotation</strong> if desired.
Finally, we will set <strong>blank</strong> to 5 seconds, to present a blank screen with fixation crosses and frames after the CFS stimulation has ended.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">masks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Mondrians</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">dirpath</span><span class="p">=</span><span class="s">&#39;../Stimuli/Masks&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">temporal_frequency</span><span class="p">=</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">duration</span><span class="p">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">position</span><span class="p">=</span><span class="s">&quot;Right&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">size</span><span class="p">=</span><span class="mf">0.45</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">padding</span><span class="p">=</span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">xy_ratio</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">contrast</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">rotation</span><span class="p">=</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">blank</span><span class="p">=</span><span class="mi">5</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="fixation-generator">
<h5>Fixation generator<a class="headerlink" href="#fixation-generator" title="Permalink to this heading">#</a></h5>
<p>Fixation target also has its own generator, you can find a tutorial on how to use it <a class="reference internal" href="fixation_generator.html"><span class="std std-doc">here</span></a>. There are multiple available shapes mainly based on <a class="reference external" href="https://doi.org/10.1016/j.visres.2012.10.012">Thaler et al., 2013</a>. Here we will generate the simplest cross:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">import</span><span class="w"> </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Generators</span><span class="p">.</span><span class="n">FixationGenerator</span>

<span class="n">generator</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">FixationGenerator</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;../Stimuli/&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">radius</span><span class="p">=</span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">hex_color</span><span class="p">=</span><span class="s">&#39;#000000&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">is_smooth_edges</span><span class="p">=</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">smoothing_cycles</span><span class="p">=</span><span class="mi">5</span><span class="p">);</span>

<span class="n">generator</span><span class="p">.</span><span class="n">C</span><span class="p">(</span><span class="n">cross_width</span><span class="p">=</span><span class="mi">64</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fixation">
<h5>Fixation<a class="headerlink" href="#fixation" title="Permalink to this heading">#</a></h5>
<p>To initialize the fixation property we will first provide a directory which contains our generated fixation target, second, we will set <strong>duration</strong> to 1 second and <strong>size</strong> to 0.05 (5%) of the frame. It also has additional parameters, like <strong>rotation</strong>, <strong>contrast</strong> etc. (for more, please, check the documentation), which we won‚Äôt set here.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">fixation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Fixation</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;../Stimuli/Fixation&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">duration</span><span class="p">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">size</span><span class="p">=</span><span class="mf">0.05</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="id1">
<h5>Stimuli<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h5>
<p>Now we will add two stimuli properties for the Gabor patches.</p>
<p>Create the properties first:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">addprop</span><span class="p">(</span><span class="s">&#39;stimulus_1&#39;</span><span class="p">);</span>
<span class="n">experiment</span><span class="p">.</span><span class="n">addprop</span><span class="p">(</span><span class="s">&#39;stimulus_2&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Then we will initialize them. As a first parameter we will provide a path to the folder with two Gabors that we presented here earlier.</p>
<p>We will set <strong>show_duration</strong> for both of the parameters to 5 seconds. We will set a different <strong>position</strong> for them: ‚ÄúLeft‚Äù for the first and ‚ÄúRight‚Äù for the second.
We will set <strong>contrast</strong> to 0.3 (30%), <strong>size</strong> to 0.5, <strong>padding</strong> to 0.5 and <strong>xy_ratio</strong> to 1.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">stimulus_1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SuppressedStimulus</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;../Stimuli/Suppressed/&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">show_duration</span><span class="p">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">position</span><span class="p">=</span><span class="s">&quot;Left&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">contrast</span><span class="p">=</span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">size</span><span class="p">=</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">padding</span><span class="p">=</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">xy_ratio</span><span class="p">=</span><span class="mi">1</span><span class="p">);</span>
<span class="n">experiment</span><span class="p">.</span><span class="n">stimulus_2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SuppressedStimulus</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;../Stimuli/Suppressed/&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">show_duration</span><span class="p">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">position</span><span class="p">=</span><span class="s">&quot;Right&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">contrast</span><span class="p">=</span><span class="mf">0.3</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="nb">size</span><span class="p">=</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">padding</span><span class="p">=</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">xy_ratio</span><span class="p">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="breakthrough">
<h5>Breakthrough<a class="headerlink" href="#breakthrough" title="Permalink to this heading">#</a></h5>
<p>Here you can set the parameters for the <strong>breakthrough</strong> property, which basically records the time and the key pressed by the participant. This is not very relevant for our needs here, so we will just initialize it and move on.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">breakthrough</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">BreakResponse</span><span class="p">();</span>
</pre></div>
</div>
<p>Our <strong>experiment</strong> object is ready now. Let‚Äôs set the number of blocks and trials. The number of blocks should be a natural number and the number of trials is defined by a list of <code class="docutils literal notranslate"><span class="pre">length=n_blocks</span></code> containing the number of trials in every block. For example, if we want to have one block with 20 trials and another block with 30 trials we will set <code class="docutils literal notranslate"><span class="pre">n_blocks</span> <span class="pre">=</span> <span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">n_trials</span> <span class="pre">=</span> <span class="pre">[20,</span> <span class="pre">30]</span></code>. But in the current experiment, there is only one block with 30 trials.
The last line will initialize a cell array for the trial matrix.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">n_blocks</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="n">n_trials</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
<span class="n">trial_matrix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n_blocks</span><span class="p">);</span>
</pre></div>
</div>
<p>Now, for all 30 trials we will create a copy of our experiment object, randomize the Gabor images and their orientations for both stimuli properties in this copied object and then add the object to the trial matrix for every trial (as the code that runs the experiment will expect trial matrix to be an array of arrays of objects).</p>
<p>For 10 of these 30 trials we will set the <strong>contrast</strong> for the second stimulus to 0, so that the right Gabor doesn‚Äôt appear.</p>
<p>After every block (here we have only one), we will shuffle the trials.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">orientations</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="mi">135</span><span class="p">];</span>
<span class="n">n_images</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="k">for</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">n_blocks</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">trial</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">n_trials</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
<span class="w">        </span><span class="n">exp_copy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">copy</span><span class="p">(</span><span class="n">experiment</span><span class="p">);</span>
<span class="w">        </span><span class="n">exp_copy</span><span class="p">.</span><span class="n">stimulus_1</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">randi</span><span class="p">(</span><span class="n">n_images</span><span class="p">);</span>
<span class="w">        </span><span class="n">exp_copy</span><span class="p">.</span><span class="n">stimulus_1</span><span class="p">.</span><span class="n">rotation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">orientations</span><span class="p">(</span><span class="nb">randi</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">orientations</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">        </span><span class="n">exp_copy</span><span class="p">.</span><span class="n">stimulus_2</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">randi</span><span class="p">(</span><span class="n">n_images</span><span class="p">);</span>
<span class="w">        </span><span class="n">exp_copy</span><span class="p">.</span><span class="n">stimulus_2</span><span class="p">.</span><span class="n">rotation</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">orientations</span><span class="p">(</span><span class="nb">randi</span><span class="p">(</span><span class="nb">length</span><span class="p">(</span><span class="n">orientations</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">trial</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">20</span>
<span class="w">            </span><span class="n">exp_copy</span><span class="p">.</span><span class="n">stimulus_2</span><span class="p">.</span><span class="n">contrast</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">        </span><span class="n">trial_matrix</span><span class="p">{</span><span class="n">block</span><span class="p">}{</span><span class="n">trial</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">exp_copy</span><span class="p">;</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">trial_matrix</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">trial_matrix</span><span class="p">{</span><span class="mi">1</span><span class="p">}(</span><span class="nb">randperm</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">trial_matrix</span><span class="p">{</span><span class="mi">1</span><span class="p">})));</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Save the trial matrix to the file:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">exist</span><span class="p">(</span><span class="s">&#39;../TrialMatrix&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;dir&#39;</span><span class="p">)</span>
<span class="w">    </span><span class="nb">mkdir</span><span class="p">(</span><span class="s">&#39;../TrialMatrix&#39;</span><span class="p">)</span>
<span class="k">end</span>
<span class="nb">save</span><span class="p">(</span><span class="s">&#39;../TrialMatrix/experiment.mat&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;trial_matrix&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Don‚Äôt forget to execute the code before running the experiment! After executing it you will find the file with the trial matrix in the <code class="docutils literal notranslate"><span class="pre">RUN_ME/TrialMatrix/</span></code> directory and generated Mondrians in the <code class="docutils literal notranslate"><span class="pre">RUN_ME/Stimuli/Masks/</span></code>.
Your <code class="docutils literal notranslate"><span class="pre">RUN_ME</span></code> folder structure now should look like this :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>RUN_ME/
‚îú‚îÄ‚îÄ Code/
|   ‚îú‚îÄ‚îÄ generate_trials.m
|   ‚îî‚îÄ‚îÄ main.m
‚îú‚îÄ‚îÄ Stimuli/
|   ‚îú‚îÄ‚îÄ Suppressed/
|   |   ‚îú‚îÄ‚îÄ gabor_1.png
|   |   ‚îî‚îÄ‚îÄ gabor_2.png
|   ‚îî‚îÄ‚îÄ Masks/
|       ‚îú‚îÄ‚îÄ mondrian_1.png
|	|   ‚ãÆ    ‚ãÆ    ‚ãÆ    ‚ãÆ
|       ‚îî‚îÄ‚îÄ mondrian_&lt;n&gt;.png
‚îî‚îÄ‚îÄ TrialMatrix/
    ‚îî‚îÄ‚îÄexperiment.mat
</pre></div>
</div>
<p>Congrats! We are almost there!</p>
</section>
</section>
</section>
</section>
<section id="the-last-step-or-two-before-the-run">
<h2>The last step (or two) before the run<a class="headerlink" href="#the-last-step-or-two-before-the-run" title="Permalink to this heading">#</a></h2>
<section id="customizing-the-instructions">
<h3>Customizing the instructions<a class="headerlink" href="#customizing-the-instructions" title="Permalink to this heading">#</a></h3>
<p>The CFSVM package comes with generic functions for instruction screens, like introduction, farewell etc., allowing you to test your experiment without paying too much attention to these screens. But when the time comes and you want to modify them, you can do it fairly easily by creating your own functions and giving a path to them to the code. If you want to use the generic function as a template, you can find them on <a class="reference external" href="https://github.com/Mudrik-Lab/CFSVM/tree/main/Examples/InfoFunctions">GitHub</a> or you can write the functions completely from scratch.</p>
<p>There are some restrictions allowing for the seamless injection of these functions to the main code:</p>
<ol class="arabic simple">
<li><p>They should be put inside one folder. Here we will create a <code class="docutils literal notranslate"><span class="pre">Code/instructions/</span></code> folder and put all the functions there.</p></li>
<li><p>Every type of instruction should be in its own <code class="docutils literal notranslate"><span class="pre">.m</span></code> file and have one of the following names:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">introduction.m</span></code> for the introduction screen shown once before the beginning of the experiment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">block_introduction_1.m</span></code> to <code class="docutils literal notranslate"><span class="pre">block_introduction_n.m</span></code> where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the number of blocks in your experiment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rest.m</span></code> for the screen shown after each trial.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">farewell.m</span></code> for the screen at the end of the experiment.</p></li>
</ul>
</li>
<li><p>The functions can‚Äôt use their own <code class="docutils literal notranslate"><span class="pre">Screen('Flip')</span></code>, meaning that they can show only one screen.</p></li>
<li><p>The function should take exactly two arguments: one for the PsychToolBox window pointer and one for the [x0,y0,x1,y1] array describing the pixels of a screen field you should put your text into (if you are using two screen fields like we do in this tutorial, every function will run two times: one time for each screen field). The function should return only one variable for the key the subject should press to proceed. The key should be a char array; you can use <a class="reference external" href="http://psychtoolbox.org/docs/KbName">KbName</a> or <a class="reference external" href="http://psychtoolbox.org/docs/KbDemo">KbDemo</a> to find the exact name of the key.</p></li>
</ol>
</section>
<section id="writing-main-m">
<h3>Writing main.m<a class="headerlink" href="#writing-main-m" title="Permalink to this heading">#</a></h3>
<p>So far we‚Äôve generated the trials. Now we want to run the experiment.
Let‚Äôs start building our <code class="docutils literal notranslate"><span class="pre">main.m</span></code> script, which we will put inside the <code class="docutils literal notranslate"><span class="pre">Code/</span></code> folder near the <code class="docutils literal notranslate"><span class="pre">generate_trials.m</span></code> script.
We will now go over a few parameters that can be adjusted to create specific settings you want.
First, we will make sure that the workspace and the screen are cleared:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">Screen</span><span class="p">(</span><span class="s">&#39;CloseAll&#39;</span><span class="p">);</span>
<span class="n">close</span><span class="w"> </span><span class="s">all</span><span class="p">;</span>
<span class="nb">clear</span><span class="p">;</span>
</pre></div>
</div>
<p>Import parts of the package we will use here:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">import</span><span class="w"> </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Experiment</span><span class="o">.*</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Element</span><span class="p">.</span><span class="n">Screen</span><span class="o">.*</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">CFSVM</span><span class="p">.</span><span class="n">Element</span><span class="p">.</span><span class="n">Data</span><span class="o">.*</span>
</pre></div>
</div>
<p>Initialize the BCFS object and provide it with the <strong>save_to_dir</strong> - path to the folder you want the results to be saved. According to the lab handbook this will be <code class="docutils literal notranslate"><span class="pre">Raw</span> <span class="pre">Data/Behavioral/</span></code>. If you created your own instruction functions you can pass the folder containing these functions to the <strong>path_to_functions</strong> argument .</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">BCFS</span><span class="p">(</span><span class="n">save_to_dir</span><span class="p">=</span><span class="s">&#39;../../../Raw Data/Behavioral&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Initialize the <strong>subject_info</strong> property by providing a directory to save the info in.
We will put it in <code class="docutils literal notranslate"><span class="pre">Tnk_experiment_2/Raw</span> <span class="pre">Data/Demographics/</span></code>.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">subject_info</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SubjectData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">dirpath</span><span class="p">=</span><span class="s">&#39;../../../Raw Data/Demographics&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Initialize <strong>trials</strong> property by providing a path to the already generated file with the trial matrix.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">trials</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">TrialsData</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">filepath</span><span class="p">=</span><span class="s">&#39;../TrialMatrix/experiment.mat&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="Adjust frames" src="_images/adjust_coords.png" /></p>
<p>Initialize the <strong>screen</strong> property by setting <strong>is_stereo</strong> to true and defining the size and location of the left rectangle by providing <strong>initial_rect</strong> with pixel coordinates of its upper left and lower right vertices, like this: [x0,y0, x1, y1]. The first two numbers in this array are x and y pixels of the upper left vertex, the last two numbers are x and y pixels of the lower right vertex. The right rectangle will be set symmetrically to the left one.</p>
<p>We will also provide hex code for the <strong>background color</strong> - <code class="docutils literal notranslate"><span class="pre">#AEAEAE</span></code> gray here.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">screen</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">CustomScreen</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">is_stereo</span><span class="p">=</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">initial_rect</span><span class="p">=[</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="mi">930</span><span class="p">,</span><span class="w"> </span><span class="mi">990</span><span class="p">],</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">background_color</span><span class="p">=</span><span class="s">&#39;#AEAEAE&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The last two lines of code are quite self explanatory:</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span><span class="p">.</span><span class="n">run</span><span class="p">()</span>

<span class="n">Screen</span><span class="p">(</span><span class="s">&#39;CloseAll&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>That‚Äôs it! You can run the <code class="docutils literal notranslate"><span class="pre">main.m</span></code> script now!</p>
</section>
</section>
<section id="running-the-experiment">
<h2>Running the experiment<a class="headerlink" href="#running-the-experiment" title="Permalink to this heading">#</a></h2>
<p>Right after executing the script you‚Äôll see the dialogue for collecting the subject data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">main</span>
<span class="n">Subject</span> <span class="n">code</span>
<span class="o">&gt;</span> <span class="n">HZ4</span>
<span class="n">Date</span> <span class="n">of</span> <span class="n">birth</span>
<span class="o">&gt;</span> <span class="mi">01011900</span>
<span class="n">Dominant</span> <span class="n">eye</span>
<span class="o">&gt;</span> <span class="n">Right</span>
<span class="n">Dominant</span> <span class="n">hand</span>
<span class="o">&gt;</span> <span class="n">Both</span>
</pre></div>
</div>
<p>Now you will proceed to the experiment itself.</p>
<p>And that‚Äôs it! Once you‚Äôve adjusted the screens, you‚Äôll see the introduction screen. After that, the CFS will begin.</p>
</section>
<section id="the-data">
<h2>The data<a class="headerlink" href="#the-data" title="Permalink to this heading">#</a></h2>
<p>The raw trial data will appear in the <code class="docutils literal notranslate"><span class="pre">Tnk_experiment_2/Raw</span> <span class="pre">Data/Behavioral/RawTrials/</span></code>. Every <code class="docutils literal notranslate"><span class="pre">.mat</span></code> file will contain an experiment object similar to the ones we have generated while creating the trial matrix, but containing timings and subject responses.
You can run <code class="docutils literal notranslate"><span class="pre">CFSVM.extract_from_raw_cfs(path_to_raw_trials)</span></code>
(<em>../../../Raw Data/Behavioral/RawTrials</em> in this example) script to extract the data from the raw files. It will create two csv tables in <code class="docutils literal notranslate"><span class="pre">Behavioral/Extracted/&lt;subject</span> <span class="pre">code&gt;/</span></code> and <code class="docutils literal notranslate"><span class="pre">Behavioral/Processed/</span></code> folders, the first one containing raw timings and the second one processed ones (e.g., durations instead of onsets and offsets).
The final folder structure will look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>TnK_experiment_2/
‚îú‚îÄ‚îÄ Experiment/
‚îÇ   ‚îî‚îÄ‚îÄ RUN_ME/
|       ‚îú‚îÄ‚îÄ Code/
|       |   ‚îú‚îÄ‚îÄ generate_trials.m
|       |   ‚îî‚îÄ‚îÄ main.m
|	‚îú‚îÄ‚îÄ Stimuli/
|       |   ‚îú‚îÄ‚îÄ Suppressed/
|       |   |   ‚îú‚îÄ‚îÄ gabor_1.png
|       |   |   ‚îî‚îÄ‚îÄ gabor_2.png
|	|   ‚îî‚îÄ‚îÄ Masks/
|       |       ‚îú‚îÄ‚îÄ mondrian_1.png
|	|	|   ‚ãÆ    ‚ãÆ    ‚ãÆ    ‚ãÆ
|       |       ‚îî‚îÄ‚îÄ mondrian_&lt;n&gt;.png
|	‚îî‚îÄ‚îÄ TrialMatrix/
|	    ‚îî‚îÄ‚îÄexperiment.mat
‚îî‚îÄ‚îÄ Raw Data/
    ‚îú‚îÄ‚îÄ Demographics/
    |	‚îî‚îÄ‚îÄ HZ4.csv
    ‚îî‚îÄ‚îÄ Behavioral/
        ‚îú‚îÄ‚îÄ Raw Trials/
	|   ‚îî‚îÄ‚îÄ HZ4/
        |       ‚îú‚îÄ‚îÄ block1_trial1.mat
 	|       |   ‚ãÆ    ‚ãÆ    ‚ãÆ    ‚ãÆ
        |       ‚îî‚îÄ‚îÄ block&lt;n&gt;_trial&lt;m&gt;.mat
        ‚îú‚îÄ‚îÄ Extracted/
	|   ‚îî‚îÄ‚îÄ HZ4/
	|       ‚îú‚îÄ‚îÄ HZ4_extracted.csv
	|	‚îî‚îÄ‚îÄ HZ4_ifis_histogram.png
        ‚îî‚îÄ‚îÄ Processed/
	    ‚îî‚îÄ‚îÄ HZ4_processed.csv
</pre></div>
</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p><img alt="Raw" src="_images/rawfiles.png" /></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><em>Raw trials</em></p></td>
</tr>
</tbody>
</table>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p><img alt="Raw" src="_images/results_unprocessed.png" /></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><em>Extracted, not processed csv</em></p></td>
</tr>
</tbody>
</table>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p><img alt="Raw" src="_images/results_processed.png" /></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p><em>Processed csv</em></p></td>
</tr>
</tbody>
</table>
</section>
<section id="thanks">
<h2>Thanks!<a class="headerlink" href="#thanks" title="Permalink to this heading">#</a></h2>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="installation.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Installation</p>
      </div>
    </a>
    <a class="right-next"
       href="fixation_generator.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Fixation generator</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#start-from-installing-the-package">Start from installing the package</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-word-of-caution">A word of caution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-parameters-from-tsuchiya-kochs-experiment-2">Extracting parameters from Tsuchiya &amp; Koch‚Äôs experiment #2</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-the-experiment">Preparing the experiment</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-experiment-folder">Create the experiment folder</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stimuli">Stimuli</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#trial-matrix">Trial matrix</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-the-package">Import the package</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-experiment-type">Choose the experiment type</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#initialize-the-objects-properties">Initialize the object‚Äôs properties</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#checkframe">Checkframe</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#masks-generation">Masks generation</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#masks-initialization">Masks initialization</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#fixation-generator">Fixation generator</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#fixation">Fixation</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Stimuli</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#breakthrough">Breakthrough</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-last-step-or-two-before-the-run">The last step (or two) before the run</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customizing-the-instructions">Customizing the instructions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#writing-main-m">Writing main.m</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-experiment">Running the experiment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-data">The data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#thanks">Thanks!</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="_sources/cfs_tutorial.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      ¬© Copyright 2023, Liad Mudrik lab.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
</div>

  </footer>
  </body>
</html>